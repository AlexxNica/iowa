---

- name: Install Neutron L3 Packages
  yum: 
    name: '{{ item }}'
    state: latest
  with_items:
    - 'openstack-neutron'
    - 'openstack-neutron-ml2'
    - 'openstack-neutron-openvswitch'
    - 'openstack-utils'
    - 'openstack-selinux'

- name: Configure Neutron L3 Agent
  template:
    src: "neutron/l3_agent.ini.{{ version }}"
    dest: "/etc/neutron/l3_agent.ini"
    backup: yes
  notify:
   - Restart Neutron L3

- name: Configure Neutron L3 Metadata
  template:
    src: "neutron/metadata_agent.ini.{{ version }}"
    dest: "/etc/neutron/metadata_agent.ini"
    backup: yes
  notify:
   - Restart Neutron Metadata

- name: Enable Neutron L3 Services
  service:
    name: "{{ item }}"
    enabled: yes
    state: started
  with_items:
    - neutron-l3-agent
    - neutron-metadata-agent
